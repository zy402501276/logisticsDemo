$.fn.bMap = function(h) { h = $.extend({ name: "map" }, h); var j = $(this),
		b = h.name,
		p, m = 116.331398,
		l = 39.897445,
		q, a, n = $("<div class='map-warp' id='Map_" + b + "'></div"),
		o = $("<input type='text' name='" + b + "' id='Map_input_" + b + "'/>"),
		g = $("<input type='hidden' name='location_" + b + "' id='Map_location_" + b + "'/>"),
		f=$();
	j.append(o).append(g).append(n).append(f); if(h.location || h.address) { if(h.location) { p = new BMap.Point(h.location[0], h.location[1]);
			m = h.location[0];
			l = h.location[1];
			g.val(m + "," + l); if(!h.address) { c(p, null, false) } else { o.val(h.address) } } else { o.val(h.address); var i = new BMap.Geocoder();
			i.getPoint(h.address, function(r) { p = r;
				m = r.lng;
				l = r.lat;
				g.val(m + "," + l) }) } } else { var k = new BMap.Geolocation();
		k.getCurrentPosition(function(t) { if(this.getStatus() == BMAP_STATUS_SUCCESS) { var s = new BMap.Marker(t.point);
				p = t.point;
				m = t.point.lng;
				l = t.point.lat } }, { enableHighAccuracy: true }) } o.focus(function(r) { n.show().css("zIndex", 999);
		d() });
	o.blur(function(r) { n.show().css("zIndex", 1000) });

	function d() { if(a) { return false } a = new BMap.Map("Map_" + b, { enableMapClick: false });
		a.centerAndZoom(new BMap.Point(m, l), 15);
		a.enableScrollWheelZoom();
		a.enableContinuousZoom();
		e(p);
		a.addEventListener("click", function(s) { e(s.point);
			c(s.point) }); var r = o.val();
		q = new BMap.Autocomplete({ input: "Map_input_" + b, location: a });
		q.setInputValue(r);
		q.addEventListener("onconfirm", function(v) { var t = v.item.value;
			myValue = t.province + t.city + t.district + t.street + t.business;

			function s() { var w = u.getResults().getPoi(0).point;
				a.centerAndZoom(w, 15);
				c(w, t);
				e(w) } var u = new BMap.LocalSearch(a, { onSearchComplete: s });
			u.search(myValue) }) }

	function c(r, s, u) { var t = new BMap.Geocoder();
		g.val(r.lng + "," + r.lat);
		t.getLocation(r, function(v) { var w = v.addressComponents; if(s) { w = $.extend(s, w) } w.business = w.business ? w.business : ""; if(q) { q.setInputValue(w.province + w.city + w.district + w.street + w.streetNumber + w.business) } else { t.getLocation(r, function(x) { o.val(x.address) }) } if(h.callback && !u) { h.callback(w, r) } }) }

	function e(r) { a.clearOverlays(); var s = new BMap.Marker(r);
		a.addOverlay(s);
		s.enableDragging();
		s.addEventListener("dragend", function(t) { c(t.point) }) } };